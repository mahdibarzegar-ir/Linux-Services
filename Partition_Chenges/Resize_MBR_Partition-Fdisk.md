
## آموزش گام‌به‌گام تغییر اندازه پارتیشن روت با استفاده از `fdisk` و `resize2fs`

تغییر اندازه پارتیشن روت بدون از دست دادن داده‌ها ممکن است، اما بسیار حساس و نیازمند دقت بالاست. در این راهنما، مراحل این کار را به ترتیب و با توضیحات کامل مرور می‌کنیم.

---

### **مرحله 1: تهیه نسخه پشتیبان**

قبل از انجام هرگونه تغییر روی پارتیشن‌ها، **از تمام داده‌های مهم نسخه پشتیبان تهیه کنید**. کوچک‌ترین اشتباه در این فرآیند می‌تواند منجر به از دست رفتن دائمی اطلاعات شود.

---

### **مرحله 2: بررسی وضعیت پارتیشن‌ها**

برای مشاهده پارتیشن‌های فعلی و بررسی فضای خالی موجود روی دیسک، یکی از دستورات زیر را اجرا کنید:

```bash
lsblk
```

یا:

```bash
sudo fdisk -l
```

* نام پارتیشن روت (معمولاً چیزی مانند `/dev/sda1`) را یادداشت کنید.
* همچنین بررسی کنید که آیا فضای خالی در انتهای دیسک برای بزرگ‌تر کردن پارتیشن موجود است یا خیر.

---

### **مرحله 3: ویرایش جدول پارتیشن با `fdisk`**

> ⚠️ توجه: مراحل زیر فقط جدول پارتیشن را بازنویسی می‌کنند، اما داده‌های درون پارتیشن در صورت اجرای صحیح، حفظ خواهند شد.

#### 3.1 ورود به ابزار fdisk

```bash
sudo fdisk /dev/sdX
```

> 🔁 `sdX` را با نام دیسک اصلی خود (مثلاً `sda`) جایگزین کنید.

#### 3.2 مشاهده لیست پارتیشن‌ها

در پنجره‌ی `fdisk`، دستور زیر را وارد کنید:

```
Command (m for help): p
```

* شماره پارتیشن روت (مثلاً 1 برای `/dev/sda1`) را یادداشت کنید.
* مقدار **Start** (بخش شروع پارتیشن) را دقیقاً یادداشت کنید، زیرا در ساخت مجدد پارتیشن باید بدون تغییر باقی بماند.

---

### **مرحله 4: حذف و بازسازی پارتیشن بدون حذف داده‌ها**

#### 4.1 حذف پارتیشن (فقط از جدول پارتیشن)

```bash
Command (m for help): d
Partition number (1-4): 1
```

* این کار فقط ورودی پارتیشن را از جدول حذف می‌کند؛ **داده‌ها پاک نمی‌شوند**.

#### 4.2 ایجاد پارتیشن جدید با اندازه بزرگ‌تر

```bash
Command (m for help): n
```

* نوع پارتیشن: `p` (برای Primary)
* شماره پارتیشن: همان شماره قبلی (مثلاً `1`)
* مقدار **Start** (بخش شروع): **دقیقاً همان مقداری که قبلاً یادداشت کرده‌اید** (معمولاً پیش‌فرض صحیح است؛ آن را تغییر ندهید).
* مقدار **End** (پایان): مقدار پیش‌فرض را وارد کنید تا حداکثر فضای خالی موجود استفاده شود.

#### 4.3 ذخیره‌سازی تغییرات

```bash
Command (m for help): w
```

* تغییرات در جدول پارتیشن نوشته شده و از `fdisk` خارج می‌شوید.

---

### **مرحله 5: گسترش فایل‌سیستم با `resize2fs`**

اکنون که اندازه پارتیشن فیزیکی بزرگ‌تر شده، باید فایل‌سیستم را نیز مطابق با آن گسترش دهید.

#### 5.1 بررسی سلامت فایل‌سیستم

```bash
sudo e2fsck -f /dev/sdXn
```

> 🔁 `sdXn` را با نام پارتیشن روت جدید (مثلاً `sda1`) جایگزین کنید.

#### 5.2 گسترش فایل‌سیستم

```bash
sudo resize2fs /dev/sdXn
```

---

### **مرحله 6: بررسی نهایی**

برای اطمینان از موفقیت عملیات، از دستور زیر استفاده کنید:

```bash
df -h
```

* بررسی کنید که اندازه پارتیشن روت افزایش یافته و فضای جدید در دسترس است.

---

### **نکات مهم و هشدارها**

* اگر مقدار **Start** و **End** را اشتباه وارد کنید، داده‌ها به طور کامل از بین خواهند رفت.
* اگر پس از اعمال تغییرات سیستم بوت نشد، ممکن است نیاز به به‌روزرسانی `grub` داشته باشید:

```bash
sudo update-grub
```

* اگر پارتیشن شما از نوع `xfs` باشد، از ابزار `xfs_growfs` استفاده کنید و نه `resize2fs`.


